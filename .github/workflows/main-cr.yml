name: Named Args with Fallbacks

on:
  workflow_dispatch:
    inputs:
      user_data:
        description: "Enter variables like name=Alice,age=28,place=Berlin"
        required: true
        default: "name=Alice,place=Berlin"

jobs:
  parse:
    runs-on: ubuntu-latest
    outputs:
      name: ${{ steps.set-vars.outputs.name }}
      age: ${{ steps.set-vars.outputs.age }}
      place: ${{ steps.set-vars.outputs.place }}

    steps:
      - id: set-vars
        run: |
          input="${{ github.event.inputs.user_data }}"
          IFS=',' read -ra pairs <<< "$input"

          for pair in "${pairs[@]}"; do
            key="${pair%%=*}"
            value="${pair#*=}"

            case "$key" in
              name) name="$value" ;;
              age) age="$value" ;;
              place) place="$value" ;;
            esac
          done

          echo "name=$name" >> $GITHUB_OUTPUT
          echo "age=$age" >> $GITHUB_OUTPUT
          echo "place=$place" >> $GITHUB_OUTPUT

  run-script:
    needs: parse
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run Python script with named args
        run: |
          python3 scripts/greet.py \
            --name="${{ needs.parse.outputs.name }}" \
            --age="${{ needs.parse.outputs.age }}" \
            --place="${{ needs.parse.outputs.place }}"
        env:
          GITHUB_ACTOR: "aveeeSi_google"
